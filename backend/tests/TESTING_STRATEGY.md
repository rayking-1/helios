# Helios自适应规划系统测试策略

## 1. 测试金字塔实现

按照测试金字塔模型，我们的测试策略按以下比例分配资源：

- **单元测试**: 70% - 主要针对各智能体的核心逻辑和独立功能
- **集成测试**: 20% - 验证智能体之间的协作和数据流
- **端到端测试**: 10% - 测试完整的用户流程和真实场景

## 2. 单元测试结构

单元测试存放在 `backend/tests/` 目录下，命名格式为 `test_[agent_name].py`。

每个智能体至少要测试以下功能：
- 初始化是否正确
- 核心方法能否正确处理预期输入
- 异常处理是否合理

## 3. 集成测试结构

集成测试存放在 `backend/tests/integration/` 目录下，主要测试：
- 智能体之间的数据流转和协作
- 智能体与工具的交互
- GroupChatManager的编排逻辑

## 4. 端到端测试

端到端测试存放在 `backend/tests/e2e/` 目录下，重点验证：
- GraphQL API的完整功能
- WebSocket实时更新机制
- 前端UI交互流程

## 5. 测试工具与技术

- **单元/集成测试**: pytest + unittest.mock
- **API测试**: FastAPI TestClient
- **端到端测试**: Playwright + pytest-playwright

## 6. CI/CD集成

所有测试均集成到GitHub Actions工作流中，确保：
- 每次PR必须通过所有单元测试和集成测试
- 夜间运行完整的端到端测试套件
- 测试覆盖率报告自动生成并归档

## 7. 问题排查流程

当测试失败时，按以下步骤排查：
1. 检查失败测试的详细日志
2. 复现问题（在本地或CI环境）
3. 使用Cursor AI分析代码与测试之间的差异
4. 修复并验证测试通过

## 8. 测试数据管理

- 关键测试数据存放在 `backend/tests/fixtures/` 目录
- 敏感测试数据通过环境变量注入
- 大型测试数据集使用外部存储，仅在测试时动态获取 